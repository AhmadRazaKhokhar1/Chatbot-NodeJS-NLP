{"version":3,"file":"sort-line.js","sourceRoot":"","sources":["sort-line.ts"],"names":[],"mappings":"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","sourcesContent":["import { array_unique } from 'array-hyper-unique';\nimport { console } from \"debug-color2\";\nimport { outputFile } from \"fs-extra\";\nimport path from \"upath2\";\nimport { serialize } from '@novel-segment/loader-line';\nimport ProjectConfig from \"../project.config\";\n\nimport {\n\tgetCjkName,\n\tglobDict,\n\tzhDictCompare,\n} from './util';\nimport { chkLineType, EnumLineType, ILoadDictFileRow2, loadDictFile } from '@novel-segment/util-compare';\n\nlet CWD = path.join(ProjectConfig.dict_root, 'blacklist');\n\nlet USE_CJK_MODE = 2;\n\nlet CACHE_LIST = {\n\tskip: [] as ILoadDictFileRow2<string[]>[],\n};\n\nglobDict(CWD, [\n\t'*.txt',\n])\n\t.tap(function (ls: string[])\n\t{\n\t\tlet a = ls.reduce(function (a, v)\n\t\t{\n\t\t\tlet p = path.relative(CWD, v);\n\n\t\t\ta.push(p);\n\n\t\t\treturn a;\n\t\t}, []);\n\n\t\tconsole.debug(a);\n\n\t\t//process.exit();\n\t})\n\t.mapSeries(async function (file: string)\n\t{\n\t\tlet _basepath = path.relative(CWD, file);\n\n\t\tconsole.debug(`[START]`, _basepath);\n\n\t\tconsole.time(_basepath);\n\n\t\tlet list = await loadDictFile<ILoadDictFileRow2<string>>(file, function (list, cur)\n\t\t{\n\t\t\tcur.file = file;\n\n\t\t\tlet w = cur.data;\n\n\t\t\tcur.line_type = chkLineType(cur.line);\n\n\t\t\tif (cur.line_type == EnumLineType.COMMENT)\n\t\t\t{\n\t\t\t\tw = w.replace(/^\\/\\//, '');\n\n\t\t\t\t//console.log(w);\n\t\t\t}\n\n\t\t\tif (!cur.line.length)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet cjk_id = getCjkName(w, USE_CJK_MODE);\n\n\t\t\tcur.cjk_id = cjk_id;\n\n\t\t\treturn true;\n\t\t}, {\n\t\t\tparseFn(line)\n\t\t\t{\n\t\t\t\treturn line.trim();\n\t\t\t},\n\t\t});\n\n\t\tlist = SortList(list);\n\n\t\tlet out_list = list\n\t\t\t.filter(v => v.line != '')\n\t\t\t.map(v => v.line)\n\t\t;\n\n\t\tout_list = array_unique(out_list);\n\n\t\t//console.log(list);\n\n\t\tlet out_file = file;\n\n\t\tif (0)\n\t\t{\n\t\t\tout_file = path.join(ProjectConfig.temp_root, path.basename(_basepath));\n\t\t}\n\n\t\tlet out_data = serialize(out_list) + \"\\n\\n\\n\";\n\n\t\tawait outputFile(out_file, out_data);\n\n\t\tconsole.timeEnd(_basepath);\n\t})\n;\n\nfunction SortList<T = ILoadDictFileRow2>(ls: T[])\n{\n\t// @ts-ignore\n\treturn ls.sort(function (a: ILoadDictFileRow2, b: ILoadDictFileRow2)\n\t{\n\t\tif (\n\t\t\ta.line_type == EnumLineType.COMMENT_TAG\n\t\t\t|| b.line_type == EnumLineType.COMMENT_TAG\n\t\t)\n\t\t{\n\t\t\treturn (a.index - b.index);\n\t\t}\n\t\telse if (\n\t\t\ta.line_type == EnumLineType.COMMENT\n\t\t\t|| b.line_type == EnumLineType.COMMENT\n\t\t)\n\t\t{\n\t\t\treturn (a.index - b.index);\n\t\t}\n\n\t\tlet ret = zhDictCompare(a.cjk_id, b.cjk_id)\n\t\t\t|| zhDictCompare(b.line, a.line)\n\t\t\t|| (a.index - b.index)\n\t\t\t|| 0\n\t\t;\n\n\t\treturn ret;\n\t})\n}\n"]}