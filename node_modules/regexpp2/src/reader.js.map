{"version":3,"file":"reader.js","sourceRoot":"","sources":["reader.ts"],"names":[],"mappings":"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","sourcesContent":["const legacyImpl = {\n    at(s: string, end: number, i: number): number {\n        return i < end ? s.charCodeAt(i) : -1\n    },\n    width(c: number): number {\n        return 1\n    },\n}\nconst unicodeImpl = {\n    at(s: string, end: number, i: number): number {\n        return i < end ? s.codePointAt(i)! : -1\n    },\n    width(c: number): number {\n        return c > 0xffff ? 2 : 1\n    },\n}\n\nexport class Reader {\n    private _impl = legacyImpl\n    private _s = \"\"\n    private _i = 0\n    private _end = 0\n    private _cp1: number = -1\n    private _w1 = 1\n    private _cp2: number = -1\n    private _w2 = 1\n    private _cp3: number = -1\n    private _w3 = 1\n    private _cp4: number = -1\n\n    public get source(): string {\n        return this._s\n    }\n\n    public get index(): number {\n        return this._i\n    }\n\n    public get currentCodePoint(): number {\n        return this._cp1\n    }\n\n    public get nextCodePoint(): number {\n        return this._cp2\n    }\n\n    public get nextCodePoint2(): number {\n        return this._cp3\n    }\n\n    public get nextCodePoint3(): number {\n        return this._cp4\n    }\n\n    public reset(\n        source: string,\n        start: number,\n        end: number,\n        uFlag: boolean,\n    ): void {\n        this._impl = uFlag ? unicodeImpl : legacyImpl\n        this._s = source\n        this._end = end\n        this.rewind(start)\n    }\n\n    public rewind(index: number): void {\n        const impl = this._impl\n        this._i = index\n        this._cp1 = impl.at(this._s, this._end, index)\n        this._w1 = impl.width(this._cp1)\n        this._cp2 = impl.at(this._s, this._end, index + this._w1)\n        this._w2 = impl.width(this._cp2)\n        this._cp3 = impl.at(this._s, this._end, index + this._w1 + this._w2)\n        this._w3 = impl.width(this._cp3)\n        this._cp4 = impl.at(\n            this._s,\n            this._end,\n            index + this._w1 + this._w2 + this._w3,\n        )\n    }\n\n    public advance(): void {\n        if (this._cp1 !== -1) {\n            const impl = this._impl\n            this._i += this._w1\n            this._cp1 = this._cp2\n            this._w1 = this._w2\n            this._cp2 = this._cp3\n            this._w2 = impl.width(this._cp2)\n            this._cp3 = this._cp4\n            this._w3 = impl.width(this._cp3)\n            this._cp4 = impl.at(\n                this._s,\n                this._end,\n                this._i + this._w1 + this._w2 + this._w3,\n            )\n        }\n    }\n\n    public eat(cp: number): boolean {\n        if (this._cp1 === cp) {\n            this.advance()\n            return true\n        }\n        return false\n    }\n\n    public eat2(cp1: number, cp2: number): boolean {\n        if (this._cp1 === cp1 && this._cp2 === cp2) {\n            this.advance()\n            this.advance()\n            return true\n        }\n        return false\n    }\n\n    public eat3(cp1: number, cp2: number, cp3: number): boolean {\n        if (this._cp1 === cp1 && this._cp2 === cp2 && this._cp3 === cp3) {\n            this.advance()\n            this.advance()\n            this.advance()\n            return true\n        }\n        return false\n    }\n}\n"]}